<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Title</title>
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css"
        integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"
          integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa"
          crossorigin="anonymous"></script>
  <script src="https://unpkg.com/axios/dist/axios.min.js"></script>

</head>
<body>

<div class="container">
  <div class="row">
    <div class="col-md-6">
      <div class="input-group">
        <span class="input-group-addon" id="basic-addon3">Address</span>
        <input type="text" class="form-control" id="address" aria-describedby="basic-addon3">
      </div>
      <div class="input-group">
        <span class="input-group-addon" id="basic-addon3">lat</span>
        <input type="text" class="form-control" id="lat" aria-describedby="basic-addon3">
      </div>
      <div class="input-group">
        <span class="input-group-addon" id="basic-addon3">lng</span>
        <input type="text" class="form-control" id="lng" aria-describedby="basic-addon3">
      </div>
      <div class="input-group">
        <span class="input-group-addon" id="basic-addon3">category</span>
        <input type="text" class="form-control" id="category" aria-describedby="basic-addon3">
      </div>
      <div class="input-group">
        <span class="input-group-addon" id="basic-addon3">src</span>
        <input type="text" class="form-control" id="src" aria-describedby="basic-addon3">
      </div>
      <div class="input-group">
        <span class="input-group-addon" id="basic-addon3">file</span>
        <input type="file" class="form-control" id="fileupload" aria-describedby="basic-addon3">
      </div> <!-- onChange="fileUpload()" -->
      <button class="btn btn-primary" id="submitBtn">Submit</button>
    </div>
    <div class="col-md-6">
      <button class="btn btn-primary" id="listBtn">Submit</button>
      <table id="listTable">
        <tr>
          <th>Category</th>
          <th>Lat</th>
          <th>Lng</th>
          <th>Address</th>
        </tr>
      </table>
    </div>
  </div>
</div>
<script>
	//var uploadfile;
	$('button#submitBtn').on('click', fileUpload);
	$('button#listBtn').on('click', retrieveAll);


	function retrieveAll(evt) {
		evt.preventDefault();
		var baseUrl = window.location.origin;
		var queryUrl = baseUrl + '/geoSearch/All';
		axios.get(queryUrl).then((response) => {
			for (var i = 0; i < response.data.length; i++) {
				console.log(response.data[i]);
				var cat = $('<td>').html(response.data[i].category);
				var lat = $('<td>').html(response.data[i].lat);
				var lng = $('<td>').html(response.data[i].lng);
				var address = $('<td>').html(response.data[i].address);
				var row = $('<tr>').append(cat).append(lat).append(lng).append(address)
				$('table#listTable').append(row);
			}
			console.log(response);
		});
	}

	function fileUpload(evt) {
		evt.preventDefault();
		var uploadfile = $('input#fileupload')[0].files[0];

		console.log(uploadfile);
		var reader = new FileReader();
		reader.onload = (e) => {
			var bstr = e.target.result;
			saveContent(uploadfile.type, bstr);
			//	console.log(e);
			//	console.log(bstr);

		};
		reader.readAsDataURL(uploadfile);
		//reader.readAsBinaryString(uploadfile);
	}

	function saveContent(fileType, fileContent) {
		var data;
		var lat = $('input#lat');
		var lng = $('input#lng');
		var cat = $('input#category');
		var src = $('input#src');
		var address = $('input#address');

		if (src.text().length <= 0 && fileType) {
			data = {
				address: address.text(),
				lat: lat.text(),
				lng: lng.text(),
				cat: cat.text(),
				file: fileContent,
				fileType: fileType
			};
		} else if (src.text().length > 0 && fileType) {
			data = {
				address: address.text(),
				lat: lat.text(),
				lng: lng.text(),
				cat: cat.text(),
				src: src.text(),
				file: fileContent,
				fileType: fileType
			};
		} else if (src.text().length > 0) {
			data = {
				address: address.text(),
				lat: lat.text(),
				lng: lng.text(),
				cat: cat.text(),
				src: src.text()
			};
		} else {
			return;
		}


		var baseUrl = window.location.origin;
		var queryUrl = baseUrl + '/geoSearch';
		axios.post(queryUrl, data).then((response) => {
			console.log(response);
		});
	}
</script>
</body>
</html>